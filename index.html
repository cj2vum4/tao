<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ°å€è·¯ç·šè¦åŠƒç³»çµ±</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide React Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <!-- éŒ¯èª¤è™•ç†å’Œèª¿è©¦ -->
    <script>
        // å…¨åŸŸéŒ¯èª¤è™•ç†
        window.addEventListener('error', function(e) {
            console.error('å…¨åŸŸéŒ¯èª¤:', e.error);
            document.getElementById('root').innerHTML = `
                <div style="padding: 20px; background: #fee; border: 1px solid #fcc; border-radius: 8px; margin: 20px;">
                    <h2 style="color: #c33;">è¼‰å…¥éŒ¯èª¤</h2>
                    <p>éŒ¯èª¤è¨Šæ¯: ${e.error.message}</p>
                    <p>è«‹æª¢æŸ¥ç€è¦½å™¨æ§åˆ¶å°ä»¥ç²å–æ›´å¤šè©³ç´°è³‡è¨Šã€‚</p>
                </div>
            `;
        });
        
        // æª¢æŸ¥ä¾è³´æ˜¯å¦è¼‰å…¥
        window.addEventListener('load', function() {
            console.log('é é¢è¼‰å…¥å®Œæˆ');
            console.log('React:', typeof React);
            console.log('ReactDOM:', typeof ReactDOM);
            console.log('Babel:', typeof Babel);
            console.log('Lucide:', typeof lucide);
            console.log('PapaParse:', typeof Papa);
        });
    </script>
    
    <!-- PapaParse for CSV parsing -->
    <script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>
    
    <style>
        /* è‡ªå®šç¾©æ¨£å¼ */
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        /* ç¢ºä¿æ»¾å‹•æ¢æ¨£å¼ */
        .overflow-y-auto::-webkit-scrollbar {
            width: 6px;
        }
        
        .overflow-y-auto::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 3px;
        }
        
        .overflow-y-auto::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        
        .overflow-y-auto::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>
<body>
    <div id="root">
        <div style="display: flex; align-items: center; justify-content: center; height: 100vh; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
            <div style="text-align: center; background: white; padding: 40px; border-radius: 16px; box-shadow: 0 20px 40px rgba(0,0,0,0.1);">
                <div style="width: 60px; height: 60px; border: 4px solid #f3f3f3; border-top: 4px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px;"></div>
                <h2 style="color: #333; margin-bottom: 10px;">è¼‰å…¥åœ°å€è·¯ç·šè¦åŠƒç³»çµ±ä¸­...</h2>
                <p style="color: #666; margin: 0;">æ­£åœ¨åˆå§‹åŒ–æ‡‰ç”¨ç¨‹å¼</p>
            </div>
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // ç°¡å–®çš„åœ–æ¨™çµ„ä»¶
        const MapPin = (props) => React.createElement('svg', {
          ...props,
          width: 24,
          height: 24,
          viewBox: '0 0 24 24',
          fill: 'none',
          stroke: 'currentColor',
          strokeWidth: 2,
          strokeLinecap: 'round',
          strokeLinejoin: 'round'
        }, React.createElement('path', { d: 'M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z' }), React.createElement('circle', { cx: 12, cy: 10, r: 3 }));
        
        const Calendar = (props) => React.createElement('svg', {
          ...props,
          width: 24,
          height: 24,
          viewBox: '0 0 24 24',
          fill: 'none',
          stroke: 'currentColor',
          strokeWidth: 2,
          strokeLinecap: 'round',
          strokeLinejoin: 'round'
        }, React.createElement('rect', { x: 3, y: 4, width: 18, height: 18, rx: 2, ry: 2 }), React.createElement('line', { x1: 16, y1: 2, x2: 16, y2: 6 }), React.createElement('line', { x1: 8, y1: 2, x2: 8, y2: 6 }), React.createElement('line', { x1: 3, y1: 10, x2: 21, y2: 10 }));
        
        const List = (props) => React.createElement('svg', {
          ...props,
          width: 24,
          height: 24,
          viewBox: '0 0 24 24',
          fill: 'none',
          stroke: 'currentColor',
          strokeWidth: 2,
          strokeLinecap: 'round',
          strokeLinejoin: 'round'
        }, React.createElement('line', { x1: 8, y1: 6, x2: 21, y2: 6 }), React.createElement('line', { x1: 8, y1: 12, x2: 21, y2: 12 }), React.createElement('line', { x1: 8, y1: 18, x2: 21, y2: 18 }), React.createElement('line', { x1: 3, y1: 6, x2: 3.01, y2: 6 }), React.createElement('line', { x1: 3, y1: 12, x2: 3.01, y2: 12 }), React.createElement('line', { x1: 3, y1: 18, x2: 3.01, y2: 18 }));
        
        const BarChart3 = (props) => React.createElement('svg', {
          ...props,
          width: 24,
          height: 24,
          viewBox: '0 0 24 24',
          fill: 'none',
          stroke: 'currentColor',
          strokeWidth: 2,
          strokeLinecap: 'round',
          strokeLinejoin: 'round'
        }, React.createElement('path', { d: 'M3 3v18h18' }), React.createElement('path', { d: 'M18 17V9' }), React.createElement('path', { d: 'M13 17V5' }), React.createElement('path', { d: 'M8 17v-3' }));
        
        const Navigation = (props) => React.createElement('svg', {
          ...props,
          width: 24,
          height: 24,
          viewBox: '0 0 24 24',
          fill: 'none',
          stroke: 'currentColor',
          strokeWidth: 2,
          strokeLinecap: 'round',
          strokeLinejoin: 'round'
        }, React.createElement('polygon', { points: '3,11 22,2 13,21 11,13 3,11' }));
        
        const Check = (props) => React.createElement('svg', {
          ...props,
          width: 24,
          height: 24,
          viewBox: '0 0 24 24',
          fill: 'none',
          stroke: 'currentColor',
          strokeWidth: 2,
          strokeLinecap: 'round',
          strokeLinejoin: 'round'
        }, React.createElement('polyline', { points: '20,6 9,17 4,12' }));
        
        const X = (props) => React.createElement('svg', {
          ...props,
          width: 24,
          height: 24,
          viewBox: '0 0 24 24',
          fill: 'none',
          stroke: 'currentColor',
          strokeWidth: 2,
          strokeLinecap: 'round',
          strokeLinejoin: 'round'
        }, React.createElement('line', { x1: 18, y1: 6, x2: 6, y2: 18 }), React.createElement('line', { x1: 6, y1: 6, x2: 18, y2: 18 }));

        const AddressRoutePlanner = () => {
          const [allData, setAllData] = useState([]);
          const [streetData, setStreetData] = useState([]);
          const [selectedStreets, setSelectedStreets] = useState([]);
          const [routeDays, setRouteDays] = useState([]);
          const [view, setView] = useState('overview');
          const [loading, setLoading] = useState(true);
          const [loadError, setLoadError] = useState(null);

          // Google Sheets ID from the URL
          const SPREADSHEET_ID = '1hub7TaS7nnFmbiNFQ-YEBL5AyKU1-x9V';

          useEffect(() => {
            loadData();
          }, []);

          // æå–é–€ç‰Œè™Ÿç¢¼ç”¨æ–¼æ’åº
          const extractHouseNumber = (address) => {
            let cleanAddr = address.replace(/[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹åç™¾]+æ¨“/, '').replace(/\d+æ¨“/, '');
            const houseMatch = cleanAddr.match(/(\d+)(?:ä¹‹(\d+))?è™Ÿ/);
            if (houseMatch) {
              const main = parseInt(houseMatch[1]);
              const sub = houseMatch[2] ? parseInt(houseMatch[2]) : 0;
              return main * 1000 + sub;
            }
            return 999999;
          };

          const loadData = async () => {
            setLoading(true);
            setLoadError(null);
            
            try {
              console.log('é–‹å§‹å¾ Google Sheets è®€å–è³‡æ–™...');
              
              // Google Sheets çš„å„å€‹å·¥ä½œè¡¨åç¨±
              const sheetNames = ['æ–°åº—å€', 'æ·±å‘å€', 'çŸ³ç¢‡å€', 'åªæ—å€', 'çƒä¾†å€'];
              let allSheetData = [];

              // é€ä¸€è®€å–æ¯å€‹å·¥ä½œè¡¨
              for (const sheetName of sheetNames) {
                try {
                  const gid = getSheetGID(sheetName);
                  const csvUrl = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/export?format=csv&gid=${gid}`;
                  
                  console.log(`æ­£åœ¨è®€å– ${sheetName} (GID: ${gid})...`);
                  
                  const response = await fetch(csvUrl);
                  if (!response.ok) {
                    throw new Error(`ç„¡æ³•è®€å– ${sheetName}: ${response.status}`);
                  }
                  
                  const csvText = await response.text();
                  
                  // æª¢æŸ¥æ˜¯å¦ç‚ºæœ‰æ•ˆçš„CSVè³‡æ–™
                  if (!csvText || csvText.trim().length === 0) {
                    throw new Error(`${sheetName} å›å‚³ç©ºè³‡æ–™`);
                  }
                  
                  // ä½¿ç”¨ PapaParse è§£æ CSV
                  const parsed = Papa.parse(csvText, {
                    header: true,
                    skipEmptyLines: true,
                    dynamicTyping: true
                  });

                  if (parsed.errors && parsed.errors.length > 0) {
                    console.warn(`${sheetName} CSV è§£æè­¦å‘Š:`, parsed.errors);
                  }

                  const sheetData = parsed.data
                    .filter(row => row && Object.keys(row).length > 0) // éæ¿¾ç©ºè¡Œ
                    .map(row => ({
                      ...row,
                      'å€åŸŸ': sheetName
                    }));

                  console.log(`${sheetName}: ${sheetData.length} ç­†è³‡æ–™`);
                  allSheetData = allSheetData.concat(sheetData);
                  
                } catch (error) {
                  console.error(`è®€å– ${sheetName} å¤±æ•—:`, error);
                  // ç¹¼çºŒå˜—è©¦å…¶ä»–å·¥ä½œè¡¨
                }
              }

              // å¦‚æœç„¡æ³•å¾ Google Sheets è®€å–è³‡æ–™ï¼Œä½¿ç”¨å‚™ç”¨è³‡æ–™
              if (allSheetData.length === 0) {
                console.log('ä½¿ç”¨å‚™ç”¨è³‡æ–™...');
                allSheetData = getFallbackData();
              }

              console.log('ç¸½è³‡æ–™ç­†æ•¸:', allSheetData.length);
              setAllData(allSheetData);

              // å»ºç«‹è¡—é“è³‡æ–™
              const streetMap = {};
              allSheetData.forEach(row => {
                const address = row['åœ°å€'] || '';
                const match = address.match(/([^å¸‚å€]+[è·¯è¡—å··å¼„])/);
                if (match) {
                  const street = match[1];
                  if (!streetMap[street]) {
                    streetMap[street] = {
                      name: street,
                      district: row['å€åŸŸ'],
                      count: 0,
                      addresses: []
                    };
                  }
                  streetMap[street].count++;
                  streetMap[street].addresses.push(row);
                }
              });

              // å°æ¯æ¢è¡—é“çš„åœ°å€æŒ‰é–€ç‰Œè™Ÿç¢¼æ’åº
              Object.values(streetMap).forEach(street => {
                street.addresses.sort((a, b) => {
                  return extractHouseNumber(a['åœ°å€']) - extractHouseNumber(b['åœ°å€']);
                });
              });

              const streets = Object.values(streetMap)
                .sort((a, b) => b.count - a.count)
                .map((s, idx) => ({ ...s, id: idx }));
              
              console.log('è¡—é“æ•¸é‡:', streets.length);
              setStreetData(streets);
              setLoading(false);
              console.log('âœ… è³‡æ–™è¼‰å…¥å®Œæˆ');
              
            } catch (error) {
              console.error('è¼‰å…¥è³‡æ–™éŒ¯èª¤:', error);
              setLoadError(error.message);
              setLoading(false);
            }
          };

          // å–å¾—å·¥ä½œè¡¨çš„ GID
          const getSheetGID = (sheetName) => {
            // å¾æ‚¨çš„ Google Sheets URL ä¸­å–å¾—çš„å¯¦éš› GID
            const gidMap = {
              'æ–°åº—å€': '1898036359',
              'æ·±å‘å€': '1059413360',
              'çŸ³ç¢‡å€': '468447500', 
              'åªæ—å€': '1135958968',
              'çƒä¾†å€': '396230333'
            };
            return gidMap[sheetName] || '1898036359';
          };

          // å‚™ç”¨è³‡æ–™
          const getFallbackData = () => {
            return [
              { 'å§“å': 'å¼µä¸‰', 'åœ°å€': 'æ–°åŒ—å¸‚æ–°åº—å€ä¸­æ­£è·¯123è™Ÿ', 'å€åŸŸ': 'æ–°åº—å€' },
              { 'å§“å': 'æå››', 'åœ°å€': 'æ–°åŒ—å¸‚æ–°åº—å€ä¸­æ­£è·¯125è™Ÿ', 'å€åŸŸ': 'æ–°åº—å€' },
              { 'å§“å': 'ç‹äº”', 'åœ°å€': 'æ–°åŒ—å¸‚æ–°åº—å€ä¸­æ­£è·¯127è™Ÿ', 'å€åŸŸ': 'æ–°åº—å€' },
              { 'å§“å': 'é™³å…­', 'åœ°å€': 'æ–°åŒ—å¸‚æ·±å‘å€æ–‡å±±è·¯45è™Ÿ', 'å€åŸŸ': 'æ·±å‘å€' },
              { 'å§“å': 'æ—ä¸ƒ', 'åœ°å€': 'æ–°åŒ—å¸‚æ·±å‘å€æ–‡å±±è·¯47è™Ÿ', 'å€åŸŸ': 'æ·±å‘å€' },
              { 'å§“å': 'é»ƒå…«', 'åœ°å€': 'æ–°åŒ—å¸‚çŸ³ç¢‡å€ç¢‡æ ¼è·¯78è™Ÿ', 'å€åŸŸ': 'çŸ³ç¢‡å€' },
              { 'å§“å': 'åŠ‰ä¹', 'åœ°å€': 'æ–°åŒ—å¸‚åªæ—å€åªæ—è¡—12è™Ÿ', 'å€åŸŸ': 'åªæ—å€' },
              { 'å§“å': 'å³å', 'åœ°å€': 'æ–°åŒ—å¸‚çƒä¾†å€çƒä¾†è¡—34è™Ÿ', 'å€åŸŸ': 'çƒä¾†å€' }
            ];
          };

          const toggleStreet = (streetId) => {
            setSelectedStreets(prev => {
              if (prev.includes(streetId)) {
                return prev.filter(id => id !== streetId);
              } else {
                return [...prev, streetId];
              }
            });
          };

          const generateRoute = () => {
            const days = parseInt(document.getElementById('dayCount').value) || 3;
            const selected = streetData.filter(s => selectedStreets.includes(s.id));
            
            const totalAddresses = selected.reduce((sum, s) => sum + s.count, 0);
            const perDay = Math.ceil(totalAddresses / days);
            
            const routes = [];
            let currentDay = [];
            let currentCount = 0;

            selected.forEach(street => {
              if (currentCount + street.count > perDay && currentDay.length > 0) {
                routes.push(currentDay);
                currentDay = [];
                currentCount = 0;
              }
              currentDay.push(street);
              currentCount += street.count;
            });

            if (currentDay.length > 0) {
              routes.push(currentDay);
            }

            setRouteDays(routes);
            setView('route');
          };

          const getTotalSelected = () => {
            return streetData
              .filter(s => selectedStreets.includes(s.id))
              .reduce((sum, s) => sum + s.count, 0);
          };

          const getDistrictInfo = () => {
            const districtStats = {};
            const selected = streetData.filter(s => selectedStreets.includes(s.id));
            
            selected.forEach(street => {
              if (!districtStats[street.district]) {
                districtStats[street.district] = { count: 0, streets: 0 };
              }
              districtStats[street.district].count += street.count;
              districtStats[street.district].streets += 1;
            });

            return districtStats;
          };

          const openInGoogleMaps = (address) => {
            const encodedAddress = encodeURIComponent(address);
            window.open(`https://www.google.com/maps/search/?api=1&query=${encodedAddress}`, '_blank');
          };

          const openDistrictInGoogleMaps = (district) => {
            const query = `æ–°åŒ—å¸‚${district}`;
            const encodedQuery = encodeURIComponent(query);
            window.open(`https://www.google.com/maps/search/?api=1&query=${encodedQuery}`, '_blank');
          };

          if (loading) {
            return (
              <div className="flex items-center justify-center h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
                <div className="text-center bg-white rounded-2xl shadow-2xl p-8 max-w-md">
                  <div className="animate-spin rounded-full h-16 w-16 border-b-4 border-indigo-600 mx-auto"></div>
                  <p className="mt-4 text-gray-700 text-lg font-medium">è¼‰å…¥åœ°å€è³‡æ–™ä¸­...</p>
                  <p className="mt-2 text-gray-500 text-sm">æ­£åœ¨å¾ Google Sheets è®€å–è³‡æ–™</p>
                </div>
              </div>
            );
          }

          if (loadError) {
            return (
              <div className="flex items-center justify-center h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
                <div className="text-center bg-white rounded-2xl shadow-2xl p-8 max-w-md">
                  <div className="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <X className="w-8 h-8 text-red-600" />
                  </div>
                  <h2 className="text-xl font-bold text-gray-900 mb-2">è¼‰å…¥å¤±æ•—</h2>
                  <p className="text-gray-600 mb-4">ç„¡æ³•å¾ Google Sheets è®€å–è³‡æ–™</p>
                  <div className="bg-red-50 border border-red-200 rounded-lg p-3 mb-4">
                    <p className="text-sm text-red-800 font-mono">{loadError}</p>
                  </div>
                  <button
                    onClick={loadData}
                    className="px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-medium"
                  >
                    é‡æ–°è¼‰å…¥
                  </button>
                  <div className="mt-4 text-left bg-blue-50 rounded-lg p-4">
                    <p className="text-sm text-gray-700 font-semibold mb-2">ğŸ’¡ è§£æ±ºæ–¹æ³•ï¼š</p>
                    <ul className="text-sm text-gray-600 space-y-1 list-disc list-inside">
                      <li>ç¢ºèª Google Sheets å·²è¨­ç‚ºã€ŒçŸ¥é“é€£çµçš„ä»»ä½•äººã€å¯æª¢è¦–</li>
                      <li>æª¢æŸ¥ç¶²è·¯é€£ç·šæ˜¯å¦æ­£å¸¸</li>
                      <li>å˜—è©¦é‡æ–°æ•´ç†é é¢ï¼ˆF5ï¼‰</li>
                    </ul>
                  </div>
                </div>
              </div>
            );
          }

          return (
            <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
              {/* Header */}
              <div className="bg-white shadow-lg">
                <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
                  <div className="flex items-center justify-between">
                    <div className="flex items-center space-x-3">
                      <Navigation className="w-8 h-8 text-indigo-600" />
                      <h1 className="text-3xl font-bold text-gray-900">åœ°å€è·¯ç·šè¦åŠƒç³»çµ±</h1>
                    </div>
                    <div className="flex space-x-2">
                      <button
                        onClick={() => setView('overview')}
                        className={`px-4 py-2 rounded-lg font-medium transition-colors ${
                          view === 'overview'
                            ? 'bg-indigo-600 text-white'
                            : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                        }`}
                      >
                        <BarChart3 className="w-5 h-5 inline mr-2" />
                        ç¸½è¦½
                      </button>
                      <button
                        onClick={() => setView('map')}
                        className={`px-4 py-2 rounded-lg font-medium transition-colors ${
                          view === 'map'
                            ? 'bg-indigo-600 text-white'
                            : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                        }`}
                        disabled={selectedStreets.length === 0}
                      >
                        <MapPin className="w-5 h-5 inline mr-2" />
                        åœ°åœ–æª¢è¦–
                      </button>
                      <button
                        onClick={() => setView('route')}
                        className={`px-4 py-2 rounded-lg font-medium transition-colors ${
                          view === 'route'
                            ? 'bg-indigo-600 text-white'
                            : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                        }`}
                        disabled={routeDays.length === 0}
                      >
                        <Calendar className="w-5 h-5 inline mr-2" />
                        è·¯ç·šè¦åŠƒ
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              {/* Stats Bar */}
              <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
                <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                  <div className="bg-white rounded-xl shadow-md p-6">
                    <div className="flex items-center justify-between">
                      <div>
                        <p className="text-sm text-gray-600">ç¸½åœ°å€æ•¸</p>
                        <p className="text-2xl font-bold text-gray-900">{allData.length}</p>
                      </div>
                      <MapPin className="w-10 h-10 text-blue-500" />
                    </div>
                  </div>
                  <div className="bg-white rounded-xl shadow-md p-6">
                    <div className="flex items-center justify-between">
                      <div>
                        <p className="text-sm text-gray-600">è¡—é“ç¸½æ•¸</p>
                        <p className="text-2xl font-bold text-gray-900">{streetData.length}</p>
                      </div>
                      <List className="w-10 h-10 text-green-500" />
                    </div>
                  </div>
                  <div className="bg-white rounded-xl shadow-md p-6">
                    <div className="flex items-center justify-between">
                      <div>
                        <p className="text-sm text-gray-600">å·²é¸æ“‡è¡—é“</p>
                        <p className="text-2xl font-bold text-indigo-600">{selectedStreets.length}</p>
                      </div>
                      <Check className="w-10 h-10 text-indigo-500" />
                    </div>
                  </div>
                  <div className="bg-white rounded-xl shadow-md p-6">
                    <div className="flex items-center justify-between">
                      <div>
                        <p className="text-sm text-gray-600">å·²é¸åœ°å€æ•¸</p>
                        <p className="text-2xl font-bold text-indigo-600">{getTotalSelected()}</p>
                      </div>
                      <Navigation className="w-10 h-10 text-purple-500" />
                    </div>
                  </div>
                </div>
              </div>

              {/* Main Content */}
              <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-12">
                {view === 'overview' && (
                  <div className="space-y-6">
                    <div className="bg-white rounded-xl shadow-lg p-6">
                      <h2 className="text-xl font-bold text-gray-900 mb-4">é¸æ“‡é«˜å¯†åº¦å€åŸŸ</h2>
                      <div className="flex items-center space-x-4 mb-4">
                        <label className="text-gray-700 font-medium">è¦åŠƒå¤©æ•¸ï¼š</label>
                        <input
                          id="dayCount"
                          type="number"
                          min="1"
                          max="10"
                          defaultValue="3"
                          className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                        />
                        <button
                          onClick={generateRoute}
                          disabled={selectedStreets.length === 0}
                          className={`px-6 py-2 rounded-lg font-medium transition-all ${
                            selectedStreets.length === 0
                              ? 'bg-gray-300 text-gray-500 cursor-not-allowed'
                              : 'bg-indigo-600 text-white hover:bg-indigo-700 shadow-md hover:shadow-lg'
                          }`}
                        >
                          ç”Ÿæˆè·¯ç·šè¦åŠƒ
                        </button>
                        {selectedStreets.length > 0 && (
                          <button
                            onClick={() => setSelectedStreets([])}
                            className="px-4 py-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 transition-colors"
                          >
                            æ¸…é™¤é¸æ“‡
                          </button>
                        )}
                      </div>
                      <p className="text-sm text-gray-500">
                        é»æ“Šä¸‹æ–¹è¡—é“å¡ç‰‡ä¾†é¸æ“‡è¦æ‹œè¨ªçš„å€åŸŸã€‚é¸æ“‡å®Œæˆå¾Œå¯ä»¥åœ¨åœ°åœ–æª¢è¦–ä¸­æŸ¥çœ‹åˆ†å¸ƒæƒ…æ³ã€‚
                      </p>
                    </div>

                    <div className="bg-white rounded-xl shadow-lg p-6">
                      <h2 className="text-xl font-bold text-gray-900 mb-4">
                        è¡—é“å¯†é›†åº¦æ’åï¼ˆå‰50åï¼‰
                      </h2>
                      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        {streetData.slice(0, 50).map((street, index) => (
                          <div
                            key={street.id}
                            onClick={() => toggleStreet(street.id)}
                            className={`cursor-pointer rounded-lg border-2 p-4 transition-all hover:shadow-lg ${
                              selectedStreets.includes(street.id)
                                ? 'border-indigo-500 bg-indigo-50 shadow-md'
                                : 'border-gray-200 bg-white hover:border-indigo-300'
                            }`}
                          >
                            <div className="flex items-start justify-between">
                              <div className="flex-1">
                                <div className="flex items-center space-x-2 mb-2">
                                  <span className="text-lg font-bold text-gray-400">#{index + 1}</span>
                                  {selectedStreets.includes(street.id) && (
                                    <Check className="w-5 h-5 text-indigo-600" />
                                  )}
                                </div>
                                <h3 className="font-bold text-gray-900 mb-1">{street.name}</h3>
                                <p className="text-sm text-gray-600 mb-2">{street.district}</p>
                                <div className="flex items-center space-x-2">
                                  <MapPin className="w-4 h-4 text-indigo-500" />
                                  <span className="text-lg font-bold text-indigo-600">
                                    {street.count} å€‹åœ°å€
                                  </span>
                                </div>
                              </div>
                            </div>
                          </div>
                        ))}
                      </div>
                    </div>
                  </div>
                )}

                {view === 'map' && selectedStreets.length > 0 && (
                  <div className="space-y-6">
                    <div className="bg-white rounded-xl shadow-lg p-6">
                      <h2 className="text-2xl font-bold text-gray-900 mb-4">åœ°åœ–æª¢è¦– - å€åŸŸåˆ†å¸ƒ</h2>
                      
                      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
                        {Object.entries(getDistrictInfo()).map(([district, info]) => (
                          <div key={district} className="bg-gradient-to-br from-indigo-50 to-purple-50 rounded-lg p-4 border-2 border-indigo-200">
                            <div className="flex items-center justify-between mb-3">
                              <h3 className="font-bold text-gray-900 text-lg">{district}</h3>
                              <button
                                onClick={() => openDistrictInGoogleMaps(district)}
                                className="px-3 py-1 bg-indigo-600 text-white text-sm rounded-lg hover:bg-indigo-700 transition-colors flex items-center space-x-1"
                              >
                                <MapPin className="w-4 h-4" />
                                <span>é–‹å•Ÿåœ°åœ–</span>
                              </button>
                            </div>
                            <div className="space-y-1">
                              <p className="text-sm text-gray-600">è¡—é“æ•¸ï¼š<span className="font-semibold text-indigo-600">{info.streets}</span></p>
                              <p className="text-sm text-gray-600">åœ°å€æ•¸ï¼š<span className="font-semibold text-indigo-600">{info.count}</span></p>
                            </div>
                          </div>
                        ))}
                      </div>

                      <h3 className="text-xl font-bold text-gray-900 mb-4">å·²é¸æ“‡çš„è¡—é“</h3>
                      <div className="space-y-3">
                        {streetData.filter(s => selectedStreets.includes(s.id)).map((street) => (
                          <div key={street.id} className="bg-gray-50 rounded-lg p-4 border border-gray-200">
                            <div className="flex items-center justify-between mb-3">
                              <div>
                                <h4 className="font-bold text-gray-900">{street.name}</h4>
                                <p className="text-sm text-gray-600">{street.district} â€¢ {street.count} å€‹åœ°å€</p>
                              </div>
                              <button
                                onClick={() => openInGoogleMaps(`${street.district}${street.name}`)}
                                className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center space-x-2"
                              >
                                <MapPin className="w-4 h-4" />
                                <span>åœ¨ Google åœ°åœ–ä¸­æŸ¥çœ‹</span>
                              </button>
                            </div>
                            
                            <details className="mt-2">
                              <summary className="cursor-pointer font-medium text-indigo-600 hover:text-indigo-700 text-sm">
                                æŸ¥çœ‹æ‰€æœ‰åœ°å€ ({street.addresses.length})
                              </summary>
                              <div className="mt-3 space-y-2 max-h-60 overflow-y-auto">
                                {street.addresses.map((addr, addrIndex) => (
                                  <div key={addrIndex} className="flex items-center justify-between text-sm border-b border-gray-200 pb-2">
                                    <div>
                                      <p className="font-medium text-gray-800">{addr['å§“å']}</p>
                                      <p className="text-gray-600">{addr['åœ°å€']}</p>
                                    </div>
                                    <button
                                      onClick={() => openInGoogleMaps(addr['åœ°å€'])}
                                      className="px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded hover:bg-blue-200 transition-colors flex items-center space-x-1"
                                    >
                                      <MapPin className="w-3 h-3" />
                                      <span>å°èˆª</span>
                                    </button>
                                  </div>
                                ))}
                              </div>
                            </details>
                          </div>
                        ))}
                      </div>
                    </div>
                  </div>
                )}

                {view === 'route' && routeDays.length > 0 && (
                  <div className="space-y-6">
                    <div className="bg-white rounded-xl shadow-lg p-6">
                      <h2 className="text-2xl font-bold text-gray-900 mb-2">
                        {routeDays.length} å¤©è·¯ç·šè¦åŠƒ
                      </h2>
                      <p className="text-gray-600 mb-4">
                        ç¸½è¨ˆ {getTotalSelected()} å€‹åœ°å€ï¼Œåˆ†é…åˆ° {routeDays.length} å¤©å®Œæˆ
                      </p>
                    </div>

                    {routeDays.map((day, dayIndex) => {
                      const dayTotal = day.reduce((sum, s) => sum + s.count, 0);
                      const dayDistricts = [...new Set(day.map(s => s.district))];
                      
                      return (
                        <div key={dayIndex} className="bg-white rounded-xl shadow-lg overflow-hidden">
                          <div className="bg-gradient-to-r from-indigo-600 to-purple-600 px-6 py-4">
                            <div className="flex items-center justify-between">
                              <h3 className="text-xl font-bold text-white flex items-center">
                                <Calendar className="w-6 h-6 mr-2" />
                                ç¬¬ {dayIndex + 1} å¤©
                              </h3>
                              <div className="text-right">
                                <p className="text-indigo-100 text-sm">æ¶µè“‹å€åŸŸï¼š{dayDistricts.join('ã€')}</p>
                                <p className="text-white font-bold">{dayTotal} å€‹åœ°å€</p>
                              </div>
                            </div>
                          </div>
                          <div className="p-6 space-y-4">
                            {day.map((street, streetIndex) => (
                              <div key={streetIndex} className="border-l-4 border-indigo-500 pl-4 py-2 bg-gray-50 rounded-r-lg">
                                <div className="flex items-center justify-between mb-2">
                                  <div className="flex items-center space-x-3">
                                    <span className="text-2xl font-bold text-indigo-600">#{streetIndex + 1}</span>
                                    <div>
                                      <h4 className="font-bold text-gray-900">{street.name}</h4>
                                      <p className="text-sm text-gray-600">{street.district}</p>
                                    </div>
                                  </div>
                                  <div className="flex items-center space-x-2">
                                    <span className="text-sm bg-indigo-100 text-indigo-700 px-3 py-1 rounded-full font-medium">
                                      {street.count} å€‹åœ°å€
                                    </span>
                                    <button
                                      onClick={() => openInGoogleMaps(`${street.district}${street.name}`)}
                                      className="px-3 py-1 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700 transition-colors flex items-center space-x-1"
                                    >
                                      <MapPin className="w-4 h-4" />
                                      <span>å°èˆª</span>
                                    </button>
                                  </div>
                                </div>
                                <details className="mt-3">
                                  <summary className="cursor-pointer font-medium text-indigo-600 hover:text-indigo-700">
                                    æŸ¥çœ‹è©³ç´°åœ°å€æ¸…å–®ï¼ˆå·²æŒ‰é–€ç‰Œè™Ÿç¢¼æ’åºï¼‰
                                  </summary>
                                  <div className="mt-3 space-y-2 max-h-60 overflow-y-auto bg-white rounded-lg p-3">
                                    {street.addresses.map((addr, addrIndex) => (
                                      <div key={addrIndex} className="flex items-center justify-between text-sm border-b border-gray-200 pb-2">
                                        <div>
                                          <p className="font-medium text-gray-800">{addr['å§“å']}</p>
                                          <p className="text-gray-600">{addr['åœ°å€']}</p>
                                        </div>
                                        <button
                                          onClick={() => openInGoogleMaps(addr['åœ°å€'])}
                                          className="px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded hover:bg-blue-200 transition-colors flex items-center space-x-1 whitespace-nowrap"
                                        >
                                          <MapPin className="w-3 h-3" />
                                          <span>å°èˆª</span>
                                        </button>
                                      </div>
                                    ))}
                                  </div>
                                </details>
                              </div>
                            ))}
                          </div>
                        </div>
                      );
                    })}
                  </div>
                )}
              </div>
            </div>
          );
        };

        // ç­‰å¾…æ‰€æœ‰ä¾è³´è¼‰å…¥å®Œæˆå¾Œå†æ¸²æŸ“
        function waitForDependencies() {
            if (typeof React === 'undefined' || typeof ReactDOM === 'undefined' || typeof Babel === 'undefined') {
                console.log('ç­‰å¾…ä¾è³´è¼‰å…¥...');
                setTimeout(waitForDependencies, 100);
                return;
            }
            
            console.log('æ‰€æœ‰ä¾è³´å·²è¼‰å…¥ï¼Œé–‹å§‹æ¸²æŸ“æ‡‰ç”¨ç¨‹å¼');
            try {
                ReactDOM.render(<AddressRoutePlanner />, document.getElementById('root'));
            } catch (error) {
                console.error('æ¸²æŸ“éŒ¯èª¤:', error);
                document.getElementById('root').innerHTML = `
                    <div style="padding: 20px; background: #fee; border: 1px solid #fcc; border-radius: 8px; margin: 20px;">
                        <h2 style="color: #c33;">æ¸²æŸ“éŒ¯èª¤</h2>
                        <p>éŒ¯èª¤è¨Šæ¯: ${error.message}</p>
                        <p>è«‹æª¢æŸ¥ç€è¦½å™¨æ§åˆ¶å°ä»¥ç²å–æ›´å¤šè©³ç´°è³‡è¨Šã€‚</p>
                    </div>
                `;
            }
        }
        
        // é–‹å§‹ç­‰å¾…ä¾è³´
        waitForDependencies();
    </script>
</body>
</html>
